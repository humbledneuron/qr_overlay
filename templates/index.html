<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #003a4d 0%, #2596be 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
        }

        .container {
            max-width: 1200px;
            width: 90%;
            margin: 2rem auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            width: 100%;
            justify-content: space-between;
        }

        .logo {
            width: 150px;
            height: 50px;
            margin-right: 20px;
            background-color: #8B5CF6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            /* color: white; */
            font-weight: bold;
            background-image: url("logo.svg");
        }

        #textContainer {
            text-align: center;
            margin: 2rem 0;
            animation: fadeIn 1s ease-out;
        }

        #textContainer h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        #textContainer p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 1rem 0;
        }

        .steps-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            padding: 0 1rem;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .step-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }

        .step.completed .step-indicator {
            background: #4CAF50;
            border-color: #45a049;
            transform: scale(1.1);
        }

        .step.completed .step-indicator::after {
            content: 'âœ“';
            position: absolute;
            font-size: 1.5rem;
        }

        .step-text {
            margin-top: 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .step.completed .step-text {
            opacity: 1;
            transform: scale(1.05);
        }

        .progress-line {
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            flex-grow: 1;
            margin: 0 1rem;
            position: relative;
            top: -25px;
            z-index: 0;
            transition: all 0.3s ease;
        }

        .progress-line.completed {
            background: #4CAF50;
        }

        .qr-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1;
            margin: 2rem auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #qrImage {
            max-width: 90%;
            max-height: 90%;
            display: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            animation: scaleIn 0.3s ease-out;
        }

        #qrImage.active {
            display: block;
        }

        .loading-items {
            display: none;
            gap: 1rem;
            position: absolute;
        }

        .loading-items.active {
            display: flex;
        }

        .loading {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: white;
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(0.5);
                opacity: 0.3;
            }
            50% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
            }

            .steps-container {
                flex-direction: column;
                gap: 2rem;
            }

            .progress-line {
                width: 3px;
                height: 30px;
                margin: 1rem 0;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const socket = io();
            const loadingElement = document.querySelector('.loading-items');
            const qrImage = document.getElementById('qrImage');
            
            loadingElement.classList.add('active');
            
            socket.on('update_qr_code_image', function(data) {
                qrImage.src = 'data:image/png;base64,' + data.qr_image;
                loadingElement.classList.remove('active');
                qrImage.classList.add('active');
            });
            
            socket.on('step_completed', function(data) {
                updateStepUI(data.step);
            });

            function updateStepUI(completedStep) {
                for (let i = 1; i <= completedStep; i++) {
                    const step = document.querySelector(`.step-${i}`);
                    const line = document.querySelector(`.line-${i}`);
                    
                    if (step) {
                        step.classList.add('completed');
                    }
                    if (line) {
                        line.classList.add('completed');
                    }
                }
            }
            
            let lastUpdateTime = Date.now();
            
            socket.on('update_qr_code_image', function() {
                lastUpdateTime = Date.now();
            });
            
            setInterval(() => {
                if (Date.now() - lastUpdateTime > 2000) {
                    loadingElement.classList.add('active');
                    qrImage.classList.remove('active');
                }
            }, 1000);
        });
    </script>
</head>
<body>
    <div class="header">
        <div class="logo">
            <!-- <img src="https://oneflow.com/app/uploads/2021/03/logo.svg" alt="Logo"> -->
            <svg xmlns="http://www.w3.org/2000/svg" width="140" height="32" viewBox="0 0 140 32" fill="none"><g clip-path="url(#clip0)"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M136.26 3.74073H140V0.000488281H136.26V3.74073ZM128.777 7.48205H132.517V3.74181H128.777V7.48205ZM74.5223 31.1492V18.176V6.33978H78.2626V31.1528H74.5223V31.1492ZM58.9929 27.4705C57.8886 29.0275 56.1072 30.5446 53.5075 31.2072C47.6853 32.6953 42.8552 29.5235 41.3562 23.6651C39.8102 17.6221 43.0109 12.2634 48.1922 11.188C58.3629 9.07711 59.5614 19.8235 59.5614 19.8235L45.3282 23.6253C46.3203 27.351 49.1517 28.9659 52.7037 28.0607C54.2534 27.6661 55.6727 26.9528 56.596 25.7181L58.9929 27.4705ZM55.8284 18.0131C54.811 14.8015 51.8999 13.6356 49.0069 14.3743C46.0777 15.1238 44.1659 17.8755 44.6584 20.8699L55.8284 18.0131ZM30.7148 10.9165H30.6859C25.4901 10.9419 22.4414 14.2838 22.4414 19.1139V31.1529H26.1817V19.1139C26.1817 15.6923 27.8327 14.4323 30.7148 14.4323C33.597 14.4323 35.248 15.6923 35.248 19.1139V31.1529H38.9883V19.1139C38.9883 14.2838 35.9396 10.9419 30.7438 10.9165H30.7148ZM132.518 11.2205H128.779V14.9608H128.779V14.9646H132.52V11.2243H132.519V11.2236H136.258V7.48339H132.518V11.2205ZM125.035 7.48053H128.776V11.2208H125.035V7.48053ZM128.776 18.7046V23.3646C128.776 26.7898 127.125 28.0498 124.239 28.0498C121.357 28.0498 119.648 26.7898 119.648 23.3682V11.2205H115.907V23.3682C115.907 26.7898 114.256 28.0498 111.371 28.0498C108.489 28.0498 106.78 26.7898 106.78 23.3646V11.2205H103.039V24.0054C103.039 28.4155 106.001 31.5656 111.345 31.5656C114.061 31.5656 116.809 30.7509 117.993 29.3714C119.401 30.7509 121.498 31.5656 124.213 31.5656C129.554 31.5656 132.519 28.4191 132.519 24.0054V18.701H128.776V18.7046ZM0 21.2283C0 26.8477 4.56939 31.4171 10.1888 31.4171C15.8082 31.4171 20.3776 26.8477 20.3776 21.2283C20.3776 15.6089 15.8082 11.0395 10.1888 11.0395C4.56939 11.0395 0 15.6089 0 21.2283ZM3.44696 21.2283C3.44696 17.5098 6.47028 14.4865 10.1888 14.4865C13.9073 14.4865 16.9306 17.5098 16.9306 21.2283C16.9306 24.9468 13.9073 27.9701 10.1888 27.9701C6.47028 27.9701 3.44696 24.9468 3.44696 21.2283ZM67.6719 9.59122H72.1254V6.33978H68.8088C63.0626 6.33978 61.4768 8.59189 61.4768 14.9499V31.1528H65.217L65.2713 18.4331L72.0168 16.6263L71.2492 13.7659L65.2858 15.3663V14.9608C65.286 14.7232 65.2854 14.4935 65.2848 14.2716V14.2701C65.2766 11.1558 65.2724 9.59122 67.6719 9.59122ZM80.4676 21.2283C80.4676 26.8477 85.037 31.4171 90.6564 31.4171C96.2722 31.4171 100.845 26.8477 100.845 21.2283C100.845 15.6089 96.2758 11.0395 90.6564 11.0395C85.037 11.0395 80.4676 15.6089 80.4676 21.2283ZM83.9145 21.2283C83.9145 17.5098 86.9379 14.4865 90.6564 14.4865C94.3713 14.4865 97.3946 17.5098 97.3982 21.2283C97.3982 24.9468 94.3749 27.9701 90.6564 27.9701C86.9379 27.9701 83.9145 24.9468 83.9145 21.2283Z"></path></g><defs><clipPath id="clip0"><rect width="140" height="31.573" fill="white"></rect></clipPath></defs></svg>
        </div>
    </div>
    <div class="container">
        <div id="textContainer">
            <h1>QR Code Scanner</h1>
            <p>Place the overlay over a QR code to begin scanning</p>
        </div>

        <div class="card">
            <div class="steps-container">
                <div class="step step-1">
                    <div class="step-indicator">1</div>
                    <div class="step-text">Scan QR</div>
                </div>
                <div class="progress-line line-1"></div>
                <div class="step step-2">
                    <div class="step-indicator">2</div>
                    <div class="step-text">Scan QR</div>
                </div>
                <div class="progress-line line-2"></div>
                <div class="step step-3">
                    <div class="step-indicator">3</div>
                    <div class="step-text">Scan QR</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="qr-container">
                <div class="loading-items">
                    <div class="loading"></div>
                    <div class="loading"></div>
                    <div class="loading"></div>
                </div>
                <img id="qrImage" alt="QR Code will appear here">
            </div>
        </div>
    </div>
</body>
</html>